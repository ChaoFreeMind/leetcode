Use a visited array to register visited elements.